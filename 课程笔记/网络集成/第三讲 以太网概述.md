# 一、以太网核心技术及要求

## 以太网核心协议CSMA/CD

CSMA/CD 为载波监听多点接入/冲突检测—为共享广播信道上主流防冲突（碰撞）协议

**多点接入** 表示若干个计算机以多点同时接入的方式连接在一根总线上。

**载波监听** 是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生冲突碰撞。

**冲突检测** 发送站点边发送数据边检测信道上的信号电压大小以检测冲突，若检测出冲突则强化冲突，并等待一随机时间再发送

<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\网络集成\第三讲 以太网概述.assets\image-20200909213436284.png" alt="image-20200909213436284" style="zoom:80%;" />

### CSMA/CD 协议的特性

- 简单：自由接入，无需控制中心（但有纪律）
- 半双工通信：总线上任一时刻只能有一对单向通信
- 低信道利用率：争用期内仍可能会冲突，而引起多次重传
- 有技术使用要求：为保证有效利用率，对传输速率、距离及接入站点数等有限制

### CSMA/CD 协议的技术参数要求

依据是共享信道接入协议CSMA/CD能有效运行：有效检测到载波、有效检测到冲突

**最大作用距离**

以防止信号的大幅度衰减并减少时延(缩短争用期)

CSMA/CD的“5－4－3”原则

限制每段电缆的最大长度为 500 m （无中继），最多5段电缆，4个中继器，其中3段电缆可以接入用户。

在使用共享集线器的以太网中，仍然受到“5－4－3” 原则的限制，一般集线器的级联不超过 3 级。 

### 802.3线缆一览

| 技术标准 | 线缆类型   | 传输距离 |
| -------- | ---------- | -------- |
| 10BASE-5 | 粗同轴电缆 | 500m     |
| 10BASE-2 | 细同轴电缆 | 200m     |
| 10BASE-T | 双绞线     | 100m     |

**注：**10BASE-5中10代表10M，BASE代表基带传输，5代表传输距离



**最小帧长**

利于接收方无效帧的判别

以太网规定最短有效帧长为 64 字节，小于64字节的视为由于冲突而异常中止的无效帧。 

**最大帧长**

实现超长控制，以解决故障问题（想想黑客攻击的最简单方法）

以太网规定为1518字节

**最小帧间隔**

使接收端来得及处理（同时也是为了信道的轮流共用），一般为9.6us

**最大站点数**

重载会引起恶性循环

为1024，是避免随机重传时间尽可能没有系统的（随机重传时间在210以内选）

**最大速率**

提高信道利用率

依据以太网信道最大利用率计算公式<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\网络集成\第三讲 以太网概述.assets\image-20200909213856644.png" alt="image-20200909213856644" style="zoom:67%;" />

# 二、以太网技术发展

## **快速以太网（F端口）**

数据传输速率为100Mbps的快速以太网，IEEE为其制订的标准为IEEE802.3u，传输介质主要包括光纤和双绞线。

| 技术标准  | 线缆类型                        | 传输距离 |
| --------- | ------------------------------- | -------- |
| 100BaseTX | EIA/TIA5类非屏蔽双绞线2对       | 100m     |
| 100BaseT4 | EIA/TIA3、4、5类非屏蔽双绞线4对 | 100m     |
| 100BaseFX | 多模光纤（MMF）线缆             | 550m-2km |
| 100BaseFX | 单模光纤（SMF）线缆             | 大于2km  |

## **千兆以太网（G口）**

在**基于以太网协议**的基础之上，将快速以太网的传输速100Mbps提高了10倍，达到了1 Gbps。 千兆以太网有两个标准：

| 技术标准   | 线缆类型                                       | 传输距离  |
| ---------- | ---------------------------------------------- | --------- |
| 1000BaseT  | 铜质EIA/TIA5e（UTP）非屏蔽双绞线4对            | 100m      |
| 1000BaseCX | 铜质屏蔽双绞线                                 | 25m       |
| 1000BaseSX | 多模光纤，50/62.5um光纤，使用波长为850nm的激光 | 550m/275m |
| 1000BaseLX | 单模光纤，9um光纤，使用波长为1300nm的激光      | 2km-15km  |

## **万兆以太网**

 **主要应用在骨干网的核心节点**之间的连接，标准主要为为IEEE 802.3ae（光纤）

| 技术标准      | 线缆类型                                                     | 传输距离          |
| ------------- | ------------------------------------------------------------ | ----------------- |
| 10GBASE-SR/SW | 多模光纤，62.5/125um光纤，或者50/125um光纤                   | 2m-300m           |
| 10GBASE-LR/LW | 多模光纤，62.5/125um光纤，或者50/125um光纤；单模光纤，10/125um光纤 | 2m-10km           |
| 10GBASE-ER/EW | 单模光纤，10/125um光纤                                       | 2m-40km           |
| 10GBase-LX4   | 多模光纤，62.5/125um光纤，或者50/125um光纤；单模光纤，10/125um光纤 | 多模300m 单模10km |

# 三、以太网主要设备工作原理

## **以太网主要设备**

- 物理层设备 中继器/集线器（HUB）
- 链路层设备 网桥/（二层）交换机
- 网络层设备 三层交换机

注：网桥是一古老说法，现在因缩写问题还沿用，与交换机等价。

## HUB工作模式

工作原理：从任何一个接口收到的数据帧（不管是单播还是广播）不加选择地转发给其它的任何端口

中继器的功能是恢复失真信号，并放大信号

- HUB为半双工设备
- HUB不使用MAC地址，只是对数据进行广播式复制转发，没有过滤功能
- 广播泛滥、冲突严重、安全性差是HUB的主要问题

## 网桥/二层交换机工作模式

工作在链路层，以==帧为信息处理单位==，采用csma/cd帧结构，并==以MAC地址进行定向转发==

以太网交换机/网桥需要完成二个基本功能：

- MAC地址学习；
- 数据帧的转发和过滤。

基于转发表进行定向转发

与站地址相关

注：目的MAC地址为广播地址时向所有接口转发

不像路由表与节点无关

<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\网络集成\第三讲 以太网概述.assets\image-20200909215530146.png" alt="image-20200909215530146" style="zoom:67%;" />

### 透明网桥的自学习算法

自学习：自动形成、更新转发表

依据：若从接口 X收到了源地址为A的帧，则从X出发可将一个帧传送到 A（A为目的地址时）。

网桥/交换机的自学习算法：网桥每收到一帧后，一定先查找转发表中与收到帧的源地址有无相匹配的记录

- 如没有，则在转发表中增加一个项目（源地址、进入接口和时间）
- 如有，则把原有的项目进行更新（用现有的接入接口和时间）

### 透明网桥的转发算法

查找转发表中与收到帧的目的地址有无相匹配的项目

- 如有，按转发表中给出的接口进行转发（但若给出的接口就是该帧进入网桥/交换机的接口，则应丢弃这个帧）

- 如没有，则向**除进入接口以外的其他所有接口广播**转发（保证一定能到达目的地）

  (弊端一是不能避免广播风暴，二是可能会产生循环回路)

### 交换机的三种交换模式

1.直通式转发: 是指交换机在收到数据帧后，不进行缓存和校验,而是直接转发到目的端口。 

2.存储式转发: 交换机首先在缓冲区中存储接收到的整个数据帧，然后进行CRC校验，检查数据帧是否正确,如果正确,再进行转发，如果不正确，则丢弃。 

3.碎片隔离式转发: 交换机在接收数据帧时，会先缓存数据帧的前64个字节，确保数据帧大于64个字节，再进行转发。

结论：相比较路由器的分组交换，交换机的交换要迅捷很多，这也是常说的交换速度远高于路由速度。

### 网桥/交换机的特点总结

- 扩大了物理范围
- 过滤通信量（隔离了冲突域）
- 可互连不同物理层、不同速率的局域网
- 整个网桥仍是一个广播域，仍易产生广播风暴
- 存储转发增加了时延 
- 但总体而言交换速度远高于路由速度

## 以太网的三层交换机

在逻辑上，三层交换和路由是等同的，三层交换的过程就是IP报文选路的过程

以太网三层交换机的主要特点：

- 在**具有二层功能**的同时提供三层功能
- 许多三层交换机用三层**高速缓冲精确查找**实现三层转发
- 针对局域网，对以太网进行了优化，大部分三层交换机只提供**以太网接口**和ATM局域网仿真接口

# 四、直连与交叉连接线

网络设备接口分MDI (Medium Dependent Interface，终端到网络连接设备 )和MDI_X（交叉，终端到终端）两种。

主机和路由器属于**同种接口MDI**；交换机和HUB属于**同种接口MDI_X**

双绞线可以分为直连网线和交叉网线，直连网线用于连接MDI和MDI_X；交叉网线用于连接MDI和MDI、或者MDI_X和。即：

**直连网线用于连接不同种接口；交叉用于连接同种接口**

# 五、以太网端口技术

以太网端口的几项基本技术：

- **自协商**
  - 以太网速率提高而如何与原10M以太网设备兼容的问题
- **流量控制**
  - 处理与发送速率不对等—网络的可靠性
- **端口聚合**
  - 提高带宽和可靠性—设备的可靠性
- **端口镜像**
  - 大流量数据的备份与监测—数据的可靠性

注：自协商为缺省模式，若需要人为指定，应先关闭自协商模式

## 自协商技术

以太网端口的自协商功能完全由物理层芯片设计实现

自协商功能允许一个网络设备将自己所支持的工作模式（包括**速率、双工模式**等）信息传递给网络上的对端，并接受对方可能传递过来的相应信息。

注意：**只对双绞线T**而言，对光纤通信不支持自协商，需手动配置两端速率/工作模式（实验时需注意，ping不通的原因之一）

### 自协商优先级

| 优先级顺序 | 工作方式         |
| ---------- | ---------------- |
| A          | 100BASE-TX全双工 |
| B          | 100BASE-T4       |
| C          | 100BASE-TX       |
| D          | 10BASE-T全双工   |
| E          | 10BASE-T         |

1.当协商双方都支持一种以上的工作方式时，需要有一个优先级方案来确定一个最终工作方式。上图按优先级从高到低的顺序列出了IEEE 802.3对上述几种工作方式优先级的排序。其基本思路是：100M优于10M，全双工优于半双工。 100BASE-T4之所以优于100BASE-TX是因为100BASE-T4支持的线缆的类型更丰富一些。

2.光纤以太网是不支持自协商的。对光纤而言，链路两端的工作模式必须使用手工配置（速度、双工模式、流控等），如果光纤两端的配置不同，是不能通信的。

对于两端工作模式都是自协商，最后协商成的结果是“**两端都支持**的工作模式中优先级最高的那一类”

## 流量控制技术

半双工：发送csma/cd协议的模拟（不是真正）冲突信号，从而使对方停下

全双工：不使用csma/cd协议，所以采用发送专门的pause帧，并用组播地址01-80-C2-00-00-01进行发送



思考：传输层用的是什么流量控制技术？

TCP中用的是停止等待协议、可变滑动窗口技术

网络拥塞一般是由于线速不匹配（如100M向10M端口发送数据）和突发的集中传输而产生的，它可能导致这几种情况：延时增加、丢包、重传增加，网络资源不能有效利用。

### 全双工流量控制

IEEE802.3x标准定义了一种新方法，在全双工环境中去实现流量控制。交换机产生一个组播地址为01-80-C2-00-00-01的 PAUSE帧，并将它发送给发送端，发送端接收到该帧后，就会暂停或停止发送。
**PAUSE帧利用了一个保留的组播地址，它不会被网桥和交换机所转发，这样，PAUSE帧不会产生附加信息量。**当端口发生阻塞时，交换机向信息源发送“PAUSE”帧，告诉信息源暂停一段时间再发送信息。

 PAUSE功能的应用场合：

- 一对终端 （简单的两点网络）
- 一个交换机和一个终端
- 交换机和交换机之间的链路

## 端口聚合

端口聚合，也称为端口捆绑、端口聚集或链路聚合。

端口聚合将多个接口聚合在一起形成1个汇聚组，实现负载分担。从外面看起来，1个汇聚组好象就是1个接口。

**端口聚合在数据链路层实现。**

优点：

-   提高链路带宽

  ​	端口聚合可以将多个连接的接口捆绑成为一个逻辑端口，捆绑后的带宽是每个独立接口的带宽总和。

-   流量负载分担

-   提高可靠性：同组成员彼此动态备份

  ​	当主干网络以很高的速率连接时，一旦出现网络连接故障，将会导致大量的数据丢失。高速服务器以及主干网络连接必须保证绝对的可靠。采用端口聚合技术可以保障网络连接的可靠性。例如，将一根电缆错误地拔下来不会导致链路中断。也就是说，组成端口聚合的某一接口连接失败，网络数据将自动重定向到那些正常工作的连接上。

### 端口聚合的限制条件

端口聚合两端的物理参数必须保持一致

- 进行聚合的链路的数目 
- 进行聚合的链路的速率 
- 进行聚合的链路的双工方式 

端口聚合两端的逻辑参数必须保持一致

- 同一个汇聚组中端口的基本配置必须保持一致
- 基本配置主要包括STP、QoS、VLAN、端口等相关配置

## 端口镜像

端口镜像一般应用于流量观测和故障定位中，它把特定的业务数据复制一份，传送到监控设备，然后进行镜像数据分析。

端口镜像可以分为基于端口的镜像和基于流的镜像两种。       

### 基于端口的镜像

基于端口的镜像是把被镜像端口的进出数据报文完全拷贝一份到镜像端口，进行流量观测或者故障定位

以太网交换机支持多对一的镜像，即将多个端口的报文复制到一个监控端口上

### 基于流的镜像

基于流的镜像指的是按照一定的数据流分类规则对数据进行分,然后将属于指定流的所有数据映射到监控端口，用于报文的分析和监视。一台交换机只支持配置一个监控端口。

基于流的镜像只对满足条件的数据流进行镜像。这些流可能具有相同的目地地址，端口号等，可根据需求灵活定义。