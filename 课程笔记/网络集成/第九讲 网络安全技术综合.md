# 一．DHCP技术要点

**DHCP的作用**  方便网络主要参数的配置和**管控**——移动接入、**私网内可以使用私有地址**，参数透明等
**DHCP的工作方式**  为**软件C/S**模式，可以安装在任何类型的计算机上，如交换机、路由器等
**DHCP地址池的类型**  地址池可以附着在服务器的某一接口（供端口所连接的终端使用），也可以附着在整个服务器上（通过不同的地址池供连接设备使用），分别为基于接口的和全局地址池
**DHCP的工作流程**  采用广播方式的发现、提供、选择、确认四阶段（网络里可能有多个DHCP服务器），首次获取服务需经历整个四阶段，再次时只需后两个阶段

**DHCP的租用期** 减少服务器的分配工作量（但客户端仍需要申请），缺省为24小时，可人为改变
**DHCP中继** 采用广播方式的申请流程限制了C/S需在同一个网段，为不同网段共用DHCP服务器，需将服务器设计为中继，具有三层交换能力的路由器和三层交换机都可以作为中继，用dhcp select relay命令

## DHCP的兼容性

<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\网络集成\第九讲 网络安全技术综合.assets\image-20201001142205937.png" alt="image-20201001142205937" style="zoom:67%;" />

# 二．地址转换NAT技术要点

**概念：**NAT（Network Address Translation），实现对IP数据包源地址和目的地址的改变，即地址转换，主要用于私网与公网之间的互访

**作用：**

- **通过私有地址，屏蔽内部网络用户，提高内部网络的安全性**
- 使使用私有地址的内部网络用户可以访问Internet
- 使内部局域网若干主机共享一个外部公有地址访问Internet
- 将内部网络服务提供给外部网络

**种类：**NAT转换有静态的一对一、动态的一对一，一对多等，其地址利用率相应不同

- **静态NAT** 公有地址与私有地址与一张静态地址映射表一一静态对应，由此只起到地址隐藏作用，地址利用率没有提高
- **动态一对一NAT** 公有地址与私有地址与动态地址映射表动态一一对应，由此在起到地址隐藏作用，地址利用率也可以通过地址释放得到提高（但不能同时满负荷工作）
- **动态一对多NAT（NAPT，P-PORT）**公有地址与私有地址与动态地址映射表借助于端口号动态一对多对应，地址利用率较高，可以同时满负荷工作
- **Easy IP** NAPT的特例，外部地址仅有一个，地址利用率最高，但性能会受影响

注意：动态NAT技术外部地址只在数据包形成时才分配，所以需与访问控制列表、防火墙技术相配合才能实现

# 三．访问控制ACL技术基础

ACL（Access Control List）的基本原理是按照具体的网络安全和流量控制需求，事先设计若干容许或拒绝规则，对通过路由器等网络设备端口上的报文（头），基于地址、协议等进行匹配，以实施出入控制

ACL本身只是规则的集合，具体执行需借助具体的网络设备和技术，常用的有防火墙、路由策略、QoS、流量过滤等

对路由器需要转发的数据包，先获取包头信息，然后和设定的规则进行比较，根据比较的结果对数据包进行转发或者丢弃。而**实现包过滤的核心技术是访问控制列表**。

## 1、ACL的分类

按照ACL规则功能的不同，ACL被划分为基本ACL、高级ACL、二层ACL、用户自定义ACL和用户ACL这五种类型。每种类型ACL对应的编号范围是不同的。

ACL 2000-2999为基本ACL，可基于源地址进行简单的报文控制

ACL 3000-3999为高级ACL，可基于源地址、目的地址、协议类型等进行细粒度的报文控制

ACL4000-4999为二层ACL，可基于端口号进行二层报文控制

ACL5000-5999为用户自定义的ACL，可以以报文的二层报文头、IP报文头等为基准，指定从第几个字节开始与掩码进行“与”操作，将从报文提取出来的字符串和用户定义的字符串进行比较，找到匹配的报文，然后进行相应的处理。

## 2、ACL规则

ACL的 “deny | permit”语句，称作ACL规则（rule），表示对报文实施拒绝/允许处理。

每条规则都拥有自己的规则编号。ACL规则的编号范围是0～4294967294，所有规则均按照规则编号从小到大进行排序。系统按照规则编号从小到大的顺序，将规则依次与报文匹配，一旦匹配上一条规则即停止匹配。

除了包含ACL动作和规则编号，看到ACL规则中还定义了源地址、生效时间段这样的字段。这些字段，称作匹配选项，它是ACL规则的重要组成部分。

## 3、ACL匹配机制

**ACL一般按照规则编号从小到大的顺序，将规则依次与报文匹配，一旦匹配上一条规则即停止匹配。**

从整个ACL匹配流程可以看出，报文与ACL规则匹配后，会产生两种匹配结果：“匹配”和“不匹配”。 

匹配（命中规则）：指存在ACL，且在ACL中查找到了符合匹配条件的规则。不论匹配的动作是“permit”还是“deny”，都称为“匹配”，而不是只是匹配上permit规则才算“匹配”。

不匹配（未命中规则）：指不存在ACL，或ACL中无规则，再或者在ACL中遍历了所有规则都没有找到符合匹配条件的规则。以上三种情况，都叫做“不匹配”。

由此造成的麻烦是编号要留有空间，否则就没有扩展的余地

## 4、 ACL规则匹配顺序

ACL定义的两种规则匹配顺序：配置顺序（config）和自动排序（auto）。

配置顺序，即系统按照ACL规则编号从小到大的顺序进行报文匹配，规则编号越小越容易被匹配。**后插入的规则，如果所指定的规则编号更小，那么这条规则可能会被先匹配上。**

自动排序，是指系统使用“深度优先”的原则（最长匹配原则），将规则按照精确度自动从高到底进行排序，规则中定义的匹配项限制越严格，规则的精确度就越高，例如，有一条规则的目的IP地址匹配项是一台主机地址2.2.2.2/32，而另一条规则的目的IP地址匹配项是一个网段2.2.2.0/24，前一条规则指定的地址范围更小，所以其精确度更高，系统会优先将报文与前一条规则进行匹配。

## 5、规则步长

规则步长，是指系统自动为ACL规则分配编号时，每个相邻规则编号之间的差值。也就是说，系统是根据步长值自动为ACL规则分配编号的。

如若采用缺省步长5，系统则按照5、10、15…这样的规律为ACL规则分配编号。如果将步长调整为了2，那么规则编号会自动从步长值开始重新排列，变成2、4、6…。

设置步长的目的，是为了方便在ACL规则之间插入新的规则。

## 6、通配符掩码

如目的地址格式为：destination { destination-address destination-wildcard | any }

中destination-wildcard为指定的地址通配符掩码。

通配符掩码的格式与IP地址相同，也是一个32比特位的数字字符串，用于指示目的IP地址中的哪些位将被检查。各比特位中，0表示“检查相应的位”，1表示“不检查相应的位”，

也可以用any表示对任意目的地址都匹配。

## 7、ACL的方向

inbound：进入方向，是站在路由器的角度（非端口），即数据包进入路由器“肚子”里面的时候

outbound：出方向，也是站在路由器的角度，即数据包从路由器的“肚子"向外发出时

但需注意：

对于防火墙而言，进出方向是相对于区域的，

inbound：从不信任区域向信任区域

outbound：从信任区域向不信任区域

## 8、ACL的执行事项

- 一个接口的同一个方向，只能调用一个acl 
- **一个acl里面可以有多个rule 规则，从上往下依次执行** 
- 数据包一旦被某rule匹配，就不再继续向下匹配 
- **用来做数据包访问控制时，默认隐含放过所有（华为设备）**