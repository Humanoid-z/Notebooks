# **一、路由器访问控制列表** 

## 1 访问控制列表的作用 

 		**安全检测**		访问控制列表是应用在路由器接口的指令列表，这些指令列表用来告诉路由器哪些数据包可以接收、哪些数据包需要拒绝。**可以由类似于源地址、目的地址、端口号、协议等特定指示条件来决定。**通过灵活地增加访问控制列表，ACL可以当作一种网络控制的有力工具，用来过滤流入和流出路由器接口的数据包。 
 		**流量控制**		建立访问控制列表后，还可以限制网络流量，提高网络性能，对通信流量起到控制的手段。

## 2 IP访问控制列表的分类 

- 标准IP访问控制列表

  阻止或者充许**来自某一网络**的所有通信流量
  标准访问控制列表检查路由的数据包的**源地址**，从而允许或拒绝基于网络、子网或主机的IP地址的所有通信流量通过**路由器的入口**。 

  注：标准IP访问控制列表的编号为1至99

  可以多个命令行用同一个编号

- 扩展IP访问控制列表 

  扩展访问控制列表既检查数据包的**源地址**，也检查数据包的**目的地址**，还检查数据包的**特定协议类型**、**端口号**等——更细粒度地控制出入口，更具有灵活性和可扩充性，如：
        可以对同一地址允许使用某些协议通信流量通过，而拒绝使用其他协议的流量通过。 

  注：扩展IP访问控制列表的编号为100至199

  可以多个命令行用同一个编号，为一组

  当然由于扩展的IP ACL可以控制源IP、目的IP、源端口、目的端口等，所以扩展ACL不仅读取IP包头的源地址/目的地址，还需读取第四层包头中的源端口和目的端口，在没有硬件ACL加速情况下，会消耗大量的CPU资源。

- 命名访问控制列表 

  标号的使用范围：在标准与扩展访问控制列表中一般使用标号，标准IP访问控制列表的编号为1至99，扩展IP访问控制列表的编号为100至199。注意可以定义多个编号相同的ACL语句作为一组

**使用名字**：用某些字符串来取代标准与扩展ACL的访问列表号，目的有二：

- 解决ACL编号不足的问题
- 可以自由地删除ACL中的一条语句，而不必删除整个ACL（编号相同的）

## **4 实现方法** 

首先在全局配置模式下定义访问列表，然后使用IP Access-Group 命令将其应用到特定的接口中，使通过该接口的数据包需要进行相应的匹配，然后决定被通过还是拒绝。
	例：Router(config)#access-list 101 deny icmp any any echo
		Router(config)#interface ethernet 0
		Router(config-if)#ip access-group 101 in 
	注意取消已经使用的ACL是在在IP语句之前加上no
		注意：访问列表语句按顺序、逻辑地处理，它们在列表中自上向下匹配数据包。遇到一匹配语句则结束匹配。在判断一个包时，同一组中的条目也是从上到下逐一进行判断）
		而若在执行到访问列表的最后，还没有与其相匹配的语句，数据包将被隐含的“拒绝”语句所拒绝。 即访问控制列表最后隐含一全否语句。

**试问一个路由器**

（1）能不能一个ACL语句都没有？
（2）能不能只有deny 语句？

若缺省的最后一个ACL是全否

不能，至少要有一个语句 permit any any，且一定要是permit

不能，至少要有一个permit语句



ACL使用命令ip access-group

![image-20201001193301042](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\网络集成\路由器访问控制.assets\image-20201001193301042.png)

注：in和out是相对于整个路由器的，且是对外链接的端口， in表示通过某端口进入到该路由器的数据包，out相反，缺省是out

## **5** **基于时间访问列表的应用** 

随着网络的发展和用户要求的变化，从IOS 12.0开始，思科(CISCO)路由器新增加了一种基于时间的访问列表。通过它，可以根据一天中的不同时间，或者根据一星期中的不同日期，或二者相结合来控制网络数据包的转发。这种基于时间的访问列表，就是在原来的标准访问列表和扩展访问列表中，加入有效的时间范围来更合理有效地控制网络。首先定义一个时间范围，然后在原来的各种访问列表的基础上应用它。 

# **二、校园网路由器访问控制** 

​		**在典型的校园网环境中，路由器一般处于防火墙的外部，负责与Internet的连接。**这种拓扑结构实际上是将路由器暴露在校园网安全防线之外，如果路由器本身又未采取适当的安全防范策略，就可能成为攻击者发起攻击的一块跳板，对内部网络安全造成威胁。 下面将以Cisco2611路由器为例，详细介绍将一台路由器配置为堡垒路由器的实现方法，使之成为校园网抵御外部攻击的第一道安全屏障。 

## **1** **基于访问表的安全防范策略** 

（1） 防止外部IP地址欺骗 
	外部网络的用户可能会使用内部网的合法IP地址或者回环地址作为源地址，从而实现非法访问。针对此类问题可建立如下访问列表：

access-list 101 deny ip 10.0.0.0 0.255.255.255 any 

access-list 101 deny ip 192.168.0.0 0.0.255.255 any 

access-list 101 deny ip 172.16.0.0 0.0.255.255 any 

! 阻止源地址（伪装）为私有地址的所有通信流。 

access-list 101 deny ip 127.0.0.0 0.255.255.255 any 

! 阻止源地址为回环地址的所有通信流。 

access-list 101 deny ip 224.0.0.0 7.255.255.255 any 

! 阻止源地址为多目的地址的所有通信流。 

access-list 101 deny ip host 0.0.0.0 any 

! 阻止没有列出源地址的通信流。 

注：可以在外部接口的向内方向（in）使用101过滤。 

（2）防止外部的非法探测 

非法访问者对内部网络发起攻击前，往往会用ping或其他命令探测网络，所以可以通过禁止从外部用ping、traceroute等探测网络来进行防范。可建立如下访问列表: 
	access-list 102 deny icmp any any echo ! 阻止用ping探测网络 

access-list 102 deny icmp any any time-exceeded ! 阻止用traceroute探测网络 

注：可在外部接口的向外方向使用102过滤。在这里主要是阻止答复输出（量少），不阻止探测进入（量大）。
	缺省的是out

（3）保护路由器不受攻击 

​	路由器一般可以通过telnet或SNMP访问，应该确保Internet上没有人能用这些协议攻击路由器。假定路由器外部接口serial0的IP为200.200.200.1，内部接口fastethernet0的IP为200.200.100.1。可以生成阻止telnet、SNMP服务的向内过滤保护路由器。建立如下访问列表： 

  **access-list 101 deny** **tcp** **any 200.200.200.1 0.0.0.0 eq 23 
 access-list 101 deny** **tcp** **any 200.200.100.1 0.0.0.0 eq 23 
 access-list 101 deny** **udp** **any 200.200.200.1 0.0.0.0 eq 161 
 access-list 101 deny** **udp** **any 200.200.100.1 0.0.0.0 eq 161** 

（4）阻止对关键端口的非法访问 

 关键端口可能是内部系统使用的端口或者是防火墙本身暴露的端口。对这些端口的访问应该加以限制，否则这些设备就很容易受到攻击。建立如下访问列表：

 access-list 101 deny tcp any any eq 135 
  access-list 101 deny tcp any any eq 137 
  access-list 101 deny tcp any any eq 138 
  access-list 101 deny tcp any any eq 139 
  access-list 101 deny udp any any eq 135 
  access-list 101 deny udp any any eq 137 
  access-list 101 deny udp any any eq 138 
  access-list 101 deny udp any any eq 139  

（5）对内部网的重要服务器进行访问限制 

对于没有配备专用防火墙的校园网，采用动态分组过滤技术建立对重要服务器的访问限制尤为重要。对于配备了专用防火墙的校园网，此项任务可以在防火墙上完成，这样可以减轻路由器的负担。无论是基于路由器实现，还是在防火墙上完成设置，首先都应该制定一套访问规则。可以考虑建立如下的访问规则:

允许外部用户到Web服务器的向内连接请求； 
允许Web服务器到外部用户的向外答复； 
允许外部SMTP服务器向内部邮件服务器的向内连接请求； 
允许内部邮件服务器向外部SMTP服务器的向外答复； 
 允许内部邮件服务器向外DNS查询； 
允许到内部邮件服务器的向内的DNS答复； 
 允许内部主机的向外TCP连接（客户端）； 
允许对请求主机的向内TCP答复。 

列出允许的所有通信流后，设计访问列表就变得简单了。其他访问规则可以根据各自的实际情况建立。**注意应将所有向内对话应用于路由器外部接口的IN方向，所有向外对话应用于路由器外部接口的OUT方向**

## **2 **常见攻击手段及其对策

(1). 防止外部ICMP重定向欺骗 
		攻击者有时会利用ICMP重定向来对路由器进行重定向，将本应送到正确目标的信息重定向到它们指定的设备，从而获得有用信息。禁止外部用户使用ICMP重定向的命令如下： 

interface serial0 

no ip redirects 

(2). 防止外部源路由欺骗 

​		源路由选择是指使用数据链路层信息来为数据报进行路由选择。该技术跨越了网络层的路由信息，使入侵者可以为内部网的数据报指定一个非法的路由，这样原本应该送到合法目的地的数据报就会被送到入侵者指定的地址。禁止使用源路由的命令如下：

no ip source-route 

(3) 防止盗用内部IP地址 

攻击者可能会盗用内部IP地址进行非法访问。针对这一问题，可以利用Cisco路由器的ARP命令将固定IP地址绑定到某一MAC地址之上。具体命令如下： 	arp 固定IP地址 MAC地址 arpa 
            解除前面加no即可

## **3** **关闭路由器上不用的服务** 

 路由器除了可以提供路径选择外，它还是一台服务器，可以提供一些有用的服务。路由器运行的这些服务可能会成为敌人攻击的突破口，为了安全起见，最好关闭这些服务。

 通过以上介绍的各种方法，我们成功地将一台普通路由器配置为一台堡垒路由器，在没有增加任何投入的情况下，提高了整个园区网的安全性。但应该说明的是，**堡垒路由器的实现是以牺牲整个网络的效率为代价的，可能会影响到园区网对外访问的速度。** 