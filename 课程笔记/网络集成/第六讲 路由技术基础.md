# 一．路由表构成

![image-20200921130449649](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\网络集成\第六讲 路由技术基础.assets\image-20200921130449649.png)

1.优先级有缺省值，以小为优，除了直接路由外都可以改变，相同目的地址，在不同协议间做比较

2.路由度量，或路由成本，只有同类路由协议才有比较意义，即在同种之间比较

3.Interface表示转发端口，与下一跳相同时，即是direct路由

# 二．特殊目的地址

**0.0.0.0/0表示缺省路由**，即当路由表没有找到完全匹配的路由时使用的路由

/32表示整个IP地址全部是网络地址，是一种特殊用法，用于虚拟地址，设备地址等

**环回地址和接口**(loopback)也是路由表中常见的，可以用整个127.0.0.0网段，但是经常使用127.0.0.1这个地址，使用环回地址的是不离开主机的数据包。

# 三．最长匹配原则

当数据报文到达路由器时，路由器首先提取出报文的目的IP地址，查找路由表，将报文的目的IP地址与路由表中的掩码字段做“与”操作，“与”操作后的结果跟路由表该表项的目的IP地址比较，相同则匹配上，否则就没有匹配上。

当所有的路由表项都匹配完后，路由器会选择一个掩码最长的匹配项。

最长匹配原则实际上是精确转发策略。

注：最长匹配原则优于优先级

最长匹配原则使得需遍历整个路由表

# 四．路由来源

表示获取到路由表的路由协议，通常有三类：

**直接路由direct**  表示由链路层获取到的路由，通常就是路由器各端口所在的网络，有多个，无需下一跳，或者说下一跳就是路由器的某端口地址

**静态路由static**   表示人工静态配置的路由，也只能是逐跳配置

**动态路由**   表示通过动态路由协议获取到的路由，来源标识是具体的路由协议，如RIP，OSPF，IS-IS等

# 五．路由优先级

表示当存在多个路由来源时，优先选用、被激活的路由（低优先级的未被激活之前不在路由表中出现）

优先级是相对协议的，如OSPF协议的路由缺省情况下是优于RIP协议路由的；所有IS-IS的路由优先级都是一样的

但静态路由比较特殊，每条静态路由的优先级都可以不相同

优先级也都有缺省值，但除了直接路由外，其它的都可手工进行配置

路由优先级缺省值：VRP缺省的路由优先级如下表：

| **路由协议** | **优先级** |
| ------------ | ---------- |
| **DIRECT**   | **0**      |
| OSPF         | 10         |
| IS-IS        | 15         |
| **STATIC**   | **60**     |
| RIP          | 100        |
| OSPF ASE     | 150        |

# 六．路由度量

路由的度量标识出了到达这条路由所指的目的地址的代价
通常路由的度量值会受到线路延迟、带宽、线路占有率、线路可信度、跳数、最大传输单元等因素的影响
不同动态路由协议会选择其中的一种或几种因素来计算度量值
**度量值只在同一种路由协议内有比较意义（或者说度量值是一种比值），不同的路由协议之间的路由度量值没有可比性**
静态路由不存在cost值，但在路由表中cost值为0

**思考：**是否会产生优先级和路由度量之间的选择矛盾？

**答**：优先级是相对于协议的相比，度量是相对于路径的

## 路由度量与等价路由ECMP

ECMP, Equal Cost Multi-Path：

**同一个路由协议，到同一个目的地有几条相同度量值的路由时，这些路由都会同时被加入到路由表中**， IP包会在这几个链路上负载分担。

# 七．静态路由

由管理员手工配置而成。因配置简单，开销小而广泛应用于小型网络中。

但需要人工维护。当一个网络故障发生后，静态路由不会自动发生改变，所以不适用于大型复杂网络。

也需要逐跳配置。

**静态路由优先级可人为逐条单独设置。**

**静态路由便于实现路径控制：均衡负载、路由备份、默认路由、数据包丢弃控制等**

## 静态路由配置命令

属性reject 和 blackhole 分别指明不可达路由和黑洞路由

当去往某一目的地的静态路由具有“reject”属性时，任何去往该目的地的IP报文都将被丢弃，并且用ICMP报文通知源主机目的地不可达；

当去往某一目的地的静态路由具有“blackhole”属性时，任何去往该目的地的IP报文都将被丢弃，并且不通知源主机，不发送ICMP不可达报文给源主机。



对同一目的网络，可通过配置多条等价的静态路由，实现均衡负载

对同一目的网络，可通过配置多条优先级不等的静态路由，实现路由备份

路由备份：同一目的地的多条路由，其中一条路由的优先级最高，做为主路由，其余的路由优先级较低，做为备份路由。静态路由也支持路由备份。

# 八．缺省路由

在路由表中，缺省路由以到网络0.0.0.0（掩码为0.0.0.0）的形式出现。

当路由器收到一个在路由表中匹配不到明确路由的数据包时，会将数据包转发给缺省路由指向的下一跳。

**使用缺省路由的目的是其可以减少路由表条目，从而减轻路由器的处理负担。**

缺省路由是一种特殊的路由，可以通过静态路由配置，某些动态路由协议也可以生成缺省路由，如OSPF和IS-IS。

## 缺省路由配置

在使用ip route-static配置静态路由时，如果将目的地址与掩码配置为全零（0.0.0.0 0.0.0.0），则表示配置的是缺省路由。例：