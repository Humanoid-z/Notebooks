# 51单片机的存储空间

51单片机存储空间划分情况：

1. ==片内==ROM==程序==存储器4KB 0000--0FFF

2. ==片外==ROM==程序==存储器60KB（地址为：0000—0FFFFH）

3. ==片内==RAM==数据==存储器256B（地址为：00—0FFH），分前128字节和后128字节

   片内RAM数据存储器前128字节中，包含128位可**位寻址**的空间（位地址范围为：00H—07FH）

   片内RAM数据存储器后128字节，为特殊功能寄存器SFR（80—0FFH离散分布）

4. ==片外==RAM==数据==存储器，容量最大可扩展到==64KB==
   注意：区分片内和片外、ROM和RAM、程序和数据存储器

# 51单片机ROM程序存储器

当向单片机下载程序时，执行代码从地址0000H开始，被依次存储到单片机片内程序存储器中

==程序计数器PC==是一个双字节的特殊功能寄存器，用于指示单片机==下一条将要执行的代码的地址==

由于程序计数器PC是一个两个字节（16位）的寄存器，受PC的制约51单片机最大的寻址范围是0000H—FFFFH，共64K

即除了51单片机片内的**4KB**程序存储器（地址0000H—0FFFH）外，单片机能寻址的外部扩展的程序存储器空间最大为64KB - 4KB =60KB，即地址1000H—FFFFH

# 程序计数器PC

由于程序计数器PC是一个两个字节（16位）的寄存器，受PC的制约51单片机最大的寻址范围是0000H—FFFFH，共64K
即除了51单片机片内的4KB程序存储器（地址0000H—0FFFH）外，单片机能寻址的外部扩展的程序存储器空间最大为64KB - 4KB =60KB，即地址1000H—FFFFH

# 51单片机片内RAM数据存储器

片内RAM数据存储器前128B可分成三个部分：**工作寄存器区**、**位寻址区**、**堆栈或数据缓冲区**

工作寄存器区、位寻址区、堆栈或数据缓冲区，这三个区都可用来保存单片机运行过程中所产生的数据或中间结果

**特点**：片内数据存储器是一个RAM，掉电后其中的数据将会丢失

51单片机最大的数据存储器（片内＋片外）RAM寻址范围也为0000H—FFFFH，共64K存储空间

<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\单片机\Untitled.assets\image-20200920205703817.png" alt="image-20200920205703817" style="zoom:80%;" />

51单片机拥有**256**个字节的片内RAM，其中前**128**个的组织结构如左图所示
其中，地址00H—1FH共32个字节是**工作寄存器区**（四组），一般通过引用工作寄存器名R0 ～ R7来使用

<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\单片机\第3讲 单片机存储器.assets\image-20201028104316597.png" alt="image-20201028104316597" style="zoom:67%;" />

另外，后面的20H—7FH共96个字节（堆栈缓冲区+位寻址区）给用户使用的

工作寄存器共有8个，分别为R0、R1、R2、R3、R4、R5、R6、R7

这8个工作寄存器每个都可以用来装载1个字节8位长度的数据，在程序中可视为一个变量来使用，常常用来作为计数值、显示值等

工作寄存器R0 ～ R7指向片内数据存储器中的地址
单片机上电复位缺省指向第0组工作寄存器区，此时可以引用R0～R7映射来对其使用

工作寄存器R0～R7除了映射片内数据存储器的地址00H～07H外，还可以映射其余的地址08H～1FH
其它三组工作寄存器也可用R0～R7来称呼

**其余三组工作寄存器区**靠程序状态字PSW选中

## 程序状态字PSW(Program State Word)

<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\单片机\Untitled.assets\image-20200920210515818.png" alt="image-20200920210515818" style="zoom:100%;" />

CY —— 进位/借位标志；位累加器；
AC —— 辅助进/借位标志；用于十进制调整；
F0  —— 用户定义标志位；软件置位/清零；
OV —— 溢出标志； 硬件置位/清零；
P   —— 奇偶标志；A中1的个数为奇数 P = 1；否则 P = 0
RS1、RS0 ——寄存器区选择控制位
                0  0 ：    0区   R0 ~ R7
                0  1 ：    1区   R0 ~ R7
                1  0 ：    2区   R0 ~ R7
                1  1 ：    3区   R0 ~ R7 
注意：剩余1位为保留未定义位

# 51单片机片内RAM位寻址和堆栈

## 片内RAM位寻址区

![image-20200920213439506](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\单片机\Untitled.assets\image-20200920213439506.png)

片内RAM数据存储器的20H—2FH（共16个字节）为位寻址区
这16个字节共有16×8=128位可被进行位寻址
位寻址指的是可对某一位单独进行操作，比如指令SETB可让位寻址区的任何一位置1，指令CLR可对位寻址区的任何一位清0

注意：每一位bit内部存储的还是0或1（表内的数字表示的是该位的位地址注意区别）
只是每一位可以被单独寻址，执行清0或置1操作
优点是简洁高效且不用考虑和影响同一字节的其它位
字节存储器的地址和位地址寻址范围是重叠的，但执行对象完全不同（字节8位vs字节中1位），由操作指令区别

在使用位寻址区时，并不是直接操作20H—2FH这16个字节，而是用图示的位映射地址来完成

![image-20200920213801144](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\单片机\Untitled.assets\image-20200920213801144.png)例如程序中需要把20H字节中的第0位清0，就需要操作20H上的第0位所映射的地址00H
     指令则为：CLR  00H;
再如想把2AH上的第4位置1，指令则为：SETB	54H;

## 片内RAM开放区

片内数据存储器的地址30H～7FH是开放给用户堆栈或数据缓冲使用的空间，也称开放区
用户可以在这段地址空间中存储单片机运行时产生的数据，也可以读取该存储空间中的数据，加载到工作寄存器、累加器等

### 堆栈指针SP

- 指明栈顶元素的地址，8位，可软件设置初值，复位时SP = 07H
- 可将堆栈指针赋值到堆栈区或开放区，实现堆栈的建立SP=2F
- “堆栈一般设在30H—7FH（或30H—FFH）的范围内”

# 51单片机片内RAM中特殊功能寄存器

特殊功能寄存器SFR（Special Function Register）

51单片机多个内部功能模块如中断控制、定时器或计数器0/1、串行口等都由特殊功能寄存器控制
每个特殊功能寄存器长度都是1个字节（8位）

共有**26**个特殊功能寄存器，离散分布于80H～0FFH地址中

![image-20200920214246278](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\单片机\Untitled.assets\image-20200920214246278.png)

支持位操作的特殊功能寄存器（凡地址能被8整除）：
B（B寄存器）    ACC（累加器）    PSW（程序状态字寄存器）  
IP（中断优先控制寄存器）     P3（P3口锁存器）     IE（中断使能寄存器）
P2（P2口锁存器）    SCON（串行口控制寄存器）
P1（P1口锁存器）    TCON（定时/计数器控制寄存器）     P0（P0口锁存器）

表中共有**5**个（4+1）双字节特殊功能寄存器
PC也为双字节寄存器，但是不在80H—FFH范围内，对用户不可见

算术运算寄存器
（1）ACC——累加器
（2）B——B寄存器，用于乘、除法运算
（3）PSW——程序状态字寄存器：包含程序运行状态和信息，

指针寄存器
（1）程序计数器PC
指单片机即将执行的下一条指令的地址（程序存储器地
址），在物理上独立，复位时PC = 0000H
（2）堆栈指针SP
指明栈顶元素的地址，8位，可软件设置初值，
复位时SP = 07H
（3）数据指针DPTR
@DPTR；指明访问数据存储器的单元地址，16位，
寻址范围64KB；DPTR = DPH + DPL，也可单独使用

输入/输出端口的寄存器
（1）并行输入/输出端口
    寄存器P0、P1、P2、P3实为相应端口锁存器
（2）串行输入/输出端口（RXD + TXD）
     i）串行数据缓冲器 SBUF
           是物理上独立的两个寄存器，共同使用一个地址 （99H）
     ii）串行控制/状态寄存器SCON
            控制监视串行口的工作状态
     iii）电源控制寄存器PCON
            控制单片机的低功耗工作方式及波特率选择

中断系统和定时器/计数器的SFR
（1）中断系统
           i）中断优先级寄存器IP：2级优先，可软件设定
           ii）中断允许寄存器IE
（2）定时/计数器
           i）定时器模式设置寄存器：TMOD
          ii）定时器控制寄存器：TCON
          iii）计数寄存器：TH0、TL0；TH1、TL1

单片机复位后SFR详细状态表

![image-20200920215142708](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\单片机\Untitled.assets\image-20200920215142708.png)



# 51单片机片外数据存储器

外部数据存储器RAM
（1）容量最大可扩展到64KB
（2）寻址范围：0000H—FFFFH
（3）寻址方式：间接寻址可用R0，R1，DPTR 

# **总结**

本讲重点：

1. 单片机存储空间有哪些？
2. 单片机的程序存储器ROM如何组织的？
3. 单片机的数据存储器RAM如何组织的？
4. 寄存器工作区的如何选择？
5. 位寻址区的位置包括哪些？
6. 特殊功能寄存器的种类和功能是什么？