# 1 推荐系统的架构

推荐系统的目的是帮助用户在“信息过载”的情况下高效地获得感兴趣的信息。因此推荐系统要处理的是**“人”和“信息”**的关系。

信息包括：

- 物品信息

  即商品推荐的商品信息、视频推荐的视频信息等

- 用户信息

  用户历史行为、用户属性、关系网络等

- 场景信息（上下文）

  时间、地点、用户状态等

## 1.1 推荐系统的逻辑框架

推荐系统要处理的问题可以较形式化地定义为：对于用户U (user)，在特定场景C (context)下，针对海量的“物品”信息，构建一个函数$f(U,I,C)$，预测用户对特定候选物品I(item)的喜好程度，再根据喜好程度对所有候选物品进行排序，生成推荐列表的问题。

![推荐系统逻辑框架](https://raw.githubusercontent.com/SNIKCHS/MDImage/main/img/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E9%80%BB%E8%BE%91%E6%A1%86%E6%9E%B6.png)

## 1.2 推荐系统的技术架构

推荐系统的技术问题分为两类：

1. **数据**和信息相关的问题，即“用户信息”“物品信息”“场景信息”分别
   是什么？ 如何存储、更新和处理？
2. 推荐系统算法和**模型**相关的问题，即推荐模型如何训练、如何预测、如何达成更好的推荐效果？

这两类问题将推荐系统分为了两个部分：

- “数据和信息”部分发展为推荐系统中融合了数据离线批处理、实时流处理的数据流框架； 
- “算法和模型”部分则细化为推荐系统中集训练（ training ）、评估（ evaluation ）、部署（ deployment ）、线上推断（ online inference ）为一体的模型框架。

![image-20220522155930705](https://raw.githubusercontent.com/SNIKCHS/MDImage/main/img/resys_technical_architecture.png)

推荐系统的数据部分负责数据收集与处理的三种平台按照**实时性**的强弱排序，依次为“客户端及服务器端实时数据处理”“流处理平台准实时数据处理”“大数据平台离线数据处理” 。在实时性由强到弱递减的同时，三种平台的海量**数据处理能力**则由弱到强。一个成熟的推荐系统的数据流系统会将三者取长补短，配合使用。

数据处理系统的数据出口主要有三个：

1. 生成推荐模型所需的样本数据，用于算法**模型训练**和评估。
2. 生成推荐模型服务（ model serving ）所需的“特征”，用于推荐系统的**线上推断**。
3. 生成系统监控、商业智能（ Business Intelligence, BI ）系统所需的统计型数据。

推荐系统的“模型部分”一般由“召回层”“排序层”“补充策略与算法层”组成。

- 召回层一般利用高效的召回规则、算法或简单的模型，**快速**从海量的候选集中召回用户可能感兴趣的物品。
- 排序层利用排序模型对初筛的候选集进行**精排**序。
- 补充策略与算法层，也被称为“再排序层”，可以在将推荐列表返回用户之前，为**兼顾结果的“多样性”**“流行度”“新鲜度”等指标，结合一些补充的策略和算法对推荐列表进行一定的调整， 最终形成用户可见的推荐列表。

从推荐模型接收到所有候选物品集， 到最后产生推荐列表， 这一过程一般称为模型服务过程。

模型的训练方法根据模型训练环境的不同，分为“离线训练” 和“在线更新” 两部分：

- **离线训练**的特点是可以利用**全量样本**和特征，使模型逼近全局最优点
- **在线更新**则可以准实时地“消化”新的数据样本，更快地**反映新的数据变化趋势**，满足模型实时性的需求。

为了评估推荐模型的效果，方便模型的迭代优化，推荐系统的模型部分提供了“离线评估”和“线上A/B 测试” 等多种评估模块，用得出的线下和线上评估指标，指导下一步的模型迭代优化。