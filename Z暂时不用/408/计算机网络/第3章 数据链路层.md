# 流量控制

## 停止等待协议

发送方每发送一帧，都要等待接收方的应答信号，之后才能发送下一帧;接收方每接收一帧，都要反馈一个应答信号，表示可接收下一帧，如果接收方不反馈应答信号，那么发送方必须一直等待。每次只允许发送一帧，然后就陷入等待接收方确认信息的过程中，因而传输效率很低。

## 滑动窗口

发送方维持一组连续的允许发送的帧的序号，称为发送窗口；同时接收方也维持一组连续的允许接收帧的序号，称为接收窗口。发送窗口用来对发送方进行流量控制,而发送窗口的大小W代表在还未收到对方确认信息的情况下发送方最多还可以发送多少个数据帧。同理，在接收端设置接收窗口是为了控制可以接收哪些数据帧和不可以接收哪些帧。在接收方，只有收到的数据帧的序号落入接收窗口内时，才允许将该数据帧收下。若接收到的数据帧落在接收窗口之外，则一律将其丢弃。

发送端每收到一个确认帧，发送窗口就向前滑动一个帧的位置，当发送窗口内没有可以发送的帧（即窗口内的帧全部是已发送但未收到确认的帧〉时，发送方就会停止发送，直到收到接收方发送的确认帧使窗口移动，窗口内有可以发送的帧后，才开始继续发送

接收端收到数据帧后，将窗口向前移一个位置，并发回确认帧，若收到的数据帧落在接收窗口之外，则一律丢弃。

# 可靠传输协议

## 后退N帧ARQ

接收窗口为1

源站每发送完一帧就要为该帧设置超时计时器。源站可以连续发送帧，若在发了N个帧后的前1个帧在超时后仍未受到其ACK，则要重传该出错帧及之后N个帧

## 选择重传ARQ

接收窗口>1，一次可以发送或接收多个帧

接收端可以发否定帧NAK给发送端要求重传

发送端只用重传超时的数据帧，接收端设置缓冲区暂存未按序收到的帧

# 介质访问控制

## CSMA/CD

CSMA/CD 的工作流程可简单概括为“先听后发，边听边发，冲突停发，随机重发”。

为了确保发送站在发送数据的同时能检测到可能存在的碰撞，需要在发送完帧之前就能收到自己发送出去的数据，即帧的传输时延至少要两倍于信号在总线中的传播时延，所以CSMA/CD总线网中的所有数据帧都必须要大于一个最小帧长。任何站点收到帧长小于最小帧长的帧时，就把它当作无效帧立即丢弃。最小帧长的计算公式为

最小帧长=总线传播时延×数据传输速率×2

## CSMA/CA

无线局域网下不能用CSMA/CD，因为实现碰撞检测花费很大，存在隐蔽站的问题

CSMA/CA 协议的基本思想是在发送数据时先广播告知其他结点，让其他结点在某段时间内不要发送数据，以免出现碰撞。

### 隐蔽站问题

站A和B都在AP的覆盖范围内，但A和B相距较远彼此都听不见对方。当A和B检测到信道空闲时，都向AP发送数据，导致碰撞的发生，这就是隐蔽站问题。

为了避免该问题，802.11允许发送站对信道进行预约，源站要发送数据帧之前先广播一个短请求发送 RTS控制帧，它包括源地址、目的地址和这次通信〈（含相应的确认帧）所持续的时间，该帧能被其范围内包括AP在内的所有站点听到。若信道空闲，则AP广播一个允许发送CTS 控制帧，它包括这次通信所需的持续时间(从RTS帧复制)，该帧也能被其范围内包括A和B在内的所有站点听到。B和其他站听到CTS后，在CTS帧中指明的时间内将抑制发送，如图3.24所示。CTS帧有两个目的:①给源站明确的发送许可;②指示其他站点在预约期内不要发送。