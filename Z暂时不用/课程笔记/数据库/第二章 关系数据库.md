# 1  关系数据结构及形式化定义

## 1.1  关系

单一的数据结构----关系
现实世界的实体以及实体间的各种联系均用关系来表示
逻辑结构----二维表 
从用户角度，关系模型中数据的逻辑结构是一张二维表

1. 域（Domain）

   域是一组具有相同数据类型的值的集合。例:
   整数
   实数
   介于某个取值范围的整数
   指定长度的字符串集合
   {‘男’，‘女’}

2. 笛卡尔积（Cartesian Product）

   给定一组域D1，D2，…，Dn，允许其中某些域是相同的。
       D1，D2，…，Dn的笛卡尔积为：
       D1×D2×…×Dn ＝         
   ｛（d1，d2，…，dn）｜diDi，i＝1，2，…，n｝
   所有域的所有取值的一个组合
   不能重复

3. 元组（Tuple）
   笛卡尔积中每一个元素（d1，d2，…，dn）叫作一个n元组（n-tuple）或简称元组
   (张清玫，计算机专业，李勇)、
       (张清玫，计算机专业，刘晨)  等 都是元组 

4. 分量（Component）
   笛卡尔积元素（d1，d2，…，dn）中的每一个值di 叫作一个分量
   张清玫、计算机专业、李勇、刘晨等都是分量 

5. 基数（Cardinal number）
   若Di（i＝1，2，…，n）为有限集，其基数为mi（i＝1，2，…，n），则D1×D2×…×Dn的基数M为：<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\Untitled.assets\image-20201024102514231.png" alt="image-20201024102514231" style="zoom:50%;" />

**关系（Relation）**

（1） 关系

D1×D2×…×Dn的子集叫作在域D1，D2，…，Dn上的
关系，表示为

         R（D1，D2，…，Dn）

R：关系名
n：关系的目或度（Degree）

（2）元组
关系中的每个元素是关系中的元组，通常用t表示。
（3）单元关系与二元关系
当n=1时，称该关系为单元关系（Unary relation）
                               或一元关系                             
当n=2时，称该关系为二元关系（Binary relation）

（4）关系的表示
关系也是一个二维表，表的每行对应一个元组，表的每
列对应一个域
（5）属性
关系中不同列可以对应相同的域
为了加以区分，必须对每列起一个名字，称为属性（Attribute）
n目关系必有n个属性

（6）码
==候选码==（Candidate key）
    若关系中的某一属性组的值能唯一地标识一个元组，则称该属性组为候选码
    简单的情况：候选码只包含一个属性
全码（All-key）
    最极端的情况：关系模式的所有属性组是这个关系模式的候选码，称为全码（All-key）

==主码==
	若一个关系有多个候选码，则选定其中一个为主码（Primary key）
==主属性==
	候选码的诸属性称为主属性（Prime attribute）
	不包含在任何侯选码中的属性称为非主属性（Non-Prime attribute）或非码属性（Non-key attribute） 

（7）三类关系
基本关系（基本表或基表）
	实际存在的表，是实际存储数据的逻辑表示
查询表
	查询结果对应的表
视图表
	由基本表或其他视图表导出的表，是虚表，不对
	应实际存储的数据

（8）基本关系的性质
① 列是同质的（Homogeneous）
② 不同的列可出自同一个域
	其中的每一列称为一个属性
	不同的属性要给予不同的属性名
③ 列的顺序无所谓,，列的次序可以任意交换
④ 任意两个元组的候选码不能相同
⑤ 行的顺序无所谓，行的次序可以任意交换

⑥ 分量必须取原子值
这是规范条件中最基本的一条

## 1.2  关系模式

### 1.2.1 什么是关系模式

关系模式（Relation Schema）是型
关系是值
关系模式是对关系的描述
	元组集合的结构
		属性构成
		属性来自的域           
		属性与域之间的映象关系
	完整性约束条件

关系模式可以形式化地表示为：
    	R（U，D，DOM，F）
		R       	     关系名
		U       	     组成该关系的属性名集合
		D       	     U中属性所来自的域
		DOM  	     属性向域的映象集合
		F        	     属性间数据的依赖关系的集合

## 1.3  关系数据库

关系数据库
在一个给定的应用领域中，所有关系的集合构成一个关系数据库
关系数据库的型与值
关系数据库的型: 关系数据库模式，是对关系数据库的描述
关系数据库的值: 关系模式在某一时刻对应的关系的集合，通常称为关系数据库

## 1.4   关系模型的存储结构

关系数据库的物理组织
有的关系数据库管理系统中一个表对应一个操作系统文件，将物理数据组织交给操作系统完成
有的关系数据库管理系统从操作系统那里申请若干个大的文件，自己划分文件空间，组织表、索引等存储结构，并进行存储管理

# 2  关系操作

常用的关系操作

- 查询操作：选择、投影、连接、除、并、差、交、笛卡尔积
  - ==选择、投影、并、差、笛卡尔基是5种基本操作==
- 数据更新：插入、删除、修改

关系操作的特点

​	集合操作方式：操作的对象和结果都是集合，**一次一集合**的方式

# 3  关系的完整性

关系的三类完整性约束:

实体完整性和参照完整性

- 关系模型必须满足的完整性约束条件称为关系的两个**不变性**，应该由关系系统自动支持

用户定义的完整性

​	应用领域需要遵循的约束条件，体现了具体领域中的语义约束 

## 3.1 实体完整性

实体完整性规则（Entity Integrity）

- 若属性A是基本关系R的主属性，则属性A不能取空值
- 空值就是“不知道”或“不存在”或“无意义”的值

​     例：
选修（学号，课程号，成绩）
“学号、课程号”为主码
“学号”和“课程号”两个属性都不能取空值

实体完整性规则的说明
（1）实体完整性规则是针对基本关系而言的。
         一个基本表通常对应现实世界的一个实体集。
（2）现实世界中的实体是可区分的，即它们具有某种唯   
          一性标识。
（3）关系模型中以主码作为唯一性标识。
（4）主码中的属性即主属性不能取空值。
   主属性取空值，就说明存在某个不可标识的实体，即存在不可区分的实体，这与第（2）点相矛盾，因此这个规则称为实体完整性

## 3.2 参照完整性

设F是基本关系R的一个或一组属性，但不是关系R的码。如果F与基本关系S的主码Ks相对应，则称F是R的**外码**

基本关系R称为**参照关系**（Referencing  Relation）

基本关系S称为**被参照关系**（Referenced Relation） 或目标关系（Target Relation）

**关系R和S不一定是不同的关系**
目标关系S的主码Ks 和参照关系的外码F必须定义在同一个（或一组）域上
外码并不一定要与相应的主码同名
     当外码与相应的主码属于不同关系时，往往取相同的名 字，以便于识别

参照完整性规则
   若属性（或属性组）F是基本关系R的外码它与基本关系S的主码Ks相对应（基本关系R和S不一定是不同的关系），则对于R中每个元组在F上的值必须为：
或者取空值（F的每个属性值均为空值）
或者等于S中某个元组的主码值

## 3.3 用户定义的完整性

针对某一具体关系数据库的约束条件，反映某一具体应用所涉及的数据必须满足的语义要求
关系模型应提供定义和检验这类完整性的机制，以便用统一的系统的方法处理它们，而不需由应用程序承担这一功能

# 4  关系代数

关系代数是一种抽象的查询语言，它用对关系的运算来表达查询
关系代数

- 运算对象是关系
- 运算结果亦为关系
- 关系代数的运算符有两类：集合运算符和专门的关系运算符

传统的集合运算是从关系的“水平”方向即行的角度进行
专门的关系运算不仅涉及行而且涉及列

![image-20201122095543622](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201122095543622.png)

## 4.1 传统的集合运算

R∪S 
仍为n目关系，由属于R或属于S的元组组成

R - S 
仍为n目关系，由属于R而不属于S的所有元组组成

R∩S
仍为n目关系，由既属于R又属于S的元组组成

笛卡尔积

![image-20201122095756298](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201122095756298.png)

## 4.2 专门的关系运算

（1） R，t$\in$R，t[Ai]
         设关系模式为R(A1，A2，…，An)
         它的一个关系设为R
          t$\in$R表示t是R的一个元组
          t[Ai]则表示元组t中相应于属性Ai的一个分量 

（2） A，t[A]，$\overline{A}$
   若A={Ai1，Ai2，…，Aik}，其中Ai1，Ai2，…，Aik是A1，A2，…，An中的一部分，则A称为属性列或属性组。
   t[A]=(t[Ai1]，t[Ai2]，…，t[Aik])表示元组t在属性列A上诸分量的集合。
   A则表示{A1，A2，…，An}中去掉{Ai1，Ai2，…，Aik}后剩余的属性组。 

（3）$\overset{\frown} {t_rt_s}$
    R为n目关系，S为m目关系。
    tr$\in$R，ts$\in$S，$\overset{\frown} {t_rt_s}$称为元组的连接。
    $\overset{\frown} {t_rt_s}$是一个n + m列的元组，前n个分量为R中的一个n元组，后m个分量为S中的一个m元组。 

（4）象集Zx
  给定一个关系R（X，Z），X和Z为属性组。
  当t[X]=x时，x在R中的象集（Images Set）为：
	           Zx={t[Z]|t $\in$R，t[X]=x}
 	它表示R中属性组X上值为x的诸元组在Z上分量的集合 

![image-20201122100842826](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201122100842826.png)

1. 选择

选择又称为限制（Restriction）
选择运算符的含义
在关系R中选择满足给定条件的诸元组
   <img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201216104006725.png" alt="image-20201216104006725" style="zoom:67%;" />
F：选择条件，是一个逻辑表达式，取值为“真”或“假”

基本形式为：X~1~θY~1~

θ表示比较运算符，它可以是＞，≥，＜，≤，＝或<>

选择运算是从关系R中选取使逻辑表达式F为真的元组，是从行的角度进行的运算

2. 投影（Projection） 

从R中选择出若干属性列组成新的关系
             <img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201216104123674.png" alt="image-20201216104123674" style="zoom:67%;" />
		A：R中的属性列 
投影操作主要是从列的角度进行运算

投影之后不仅取消了原关系中的某些列，而且还可能取消某些元组（**避免重复行**）

3. 连接（Join） 

连接也称为θ连接
连接运算的含义
从两个关系的笛卡尔积中选取属性间满足一定条件的元组
	 <img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201216104420274.png" alt="image-20201216104420274" style="zoom:67%;" />

A和B：分别为R和S上度数相等且可比的属性组
θ：比较运算符 
连接运算从R和S的广义笛卡尔积R×S中选取R关系在A属性组上的值与S关系在B属性组上的值满足比较关系θ的元组 

两类常用连接运算

等值连接（equijoin） 
θ为“＝”的连接运算称为等值连接
从关系R与S的广义笛卡尔积中选取A、B属性值相等的那些元组，即等值连接为：
     <img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201216105851329.png" alt="image-20201216105851329" style="zoom:67%;" />



自然连接（Natural join） 

自然连接是一种特殊的等值连接

- 两个关系中进行比较的分量必须是相同的属性组
- 在结果中把重复的属性列去掉

自然连接的含义
	R和S具有相同的属性组B
      ![image-20201216111124667](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201216111124667.png)

 自然连接还需要取消重复列，所以是同时从行和列的角度进行运算。 

悬浮元组（Dangling tuple）
两个关系R和S在做自然连接时，关系R中某些元组有可能在S中不存在公共属性上值相等的元组，从而造成R中这些元组在操作时被舍弃了，这些被舍弃的元组称为悬浮元组。

外连接（Outer Join）

- 如果把悬浮元组也保存在结果关系中，而在其他属性上填空值(Null)，就叫做外连接
- 左外连接(LEFT OUTER JOIN或LEFT JOIN)
  - 只保留左边关系R中的悬浮元组
- 右外连接(RIGHT OUTER JOIN或RIGHT JOIN)
  - 只保留右边关系S中的悬浮元组

4. 除运算（Division） 

给定关系R (X，Y) 和S (Y，Z)，其中X，Y，Z为属性组。
R中的Y与S中的Y可以有不同的属性名，但必须出自相同的
域集。
R与S的除运算得到一个新的关系P(X)，
P是R中满足下列条件的元组在 X 属性列上的投影：
元组在X上分量值x的象集Yx包含S在Y上投影的集合，记作：
       R÷S={tr[X]|trR∧πY(S)Yx}
       Yx：x在R中的象集，x = tr[X]

[例2.9]设关系R、S分别为下图的(a)和(b)，RS的结果为图(c) 

![image-20201216112353079](C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201216112353079.png)

在关系R中，A可以取四个值{a1，a2，a3，a4}
    a1的象集为 {(b1，c2)，(b2，c3)，(b2，c1)}
    a2的象集为 {(b3，c7)，(b2，c3)}
    a3的象集为 {(b4，c6)}
    a4的象集为 {(b6，c6)}
S在(B，C)上的投影为
           {(b1，c2)，(b2，c1)，(b2，c3) }
只有a1的象集包含了S在(B，C)属性组上的投影
     所以     R÷S ={a1} 

以学生-课程数据库为例 
[例2.10]  查询至少选修1号课程和3号课程的学生号码 。

首先建立一个临时关系K： 

<img src="C:\Users\12548\Documents\GitHub\Notebooks\课程笔记\数据库\第二章 关系数据库.assets\image-20201216112425350.png" alt="image-20201216112425350" style="zoom:50%;" />

然后求：πSno,Cno(SC)÷K
    πSno,Cno(SC)

	201215121象集{1，2，3}
	201215122象集{2，3}
	K={1，3}
   于是：πSno,Cno(SC)÷K={201215121}

[例2.11]  查询选修了2号课程的学生的学号。
    πSno(σCno=‘2’(SC))={201215121,201215122}
[例2.12]  查询至少选修了一门其直接先行课为5号课程的学生姓名
     πSname(σCpno=‘5’(Course    SC   πSno,Sname (Student))  
或    
      πSname (πSno (σCpno='5' (Course)   SC)    πSno,Sname (Student))  
[例2.13]  查询选修了全部课程的学生号码和姓名。
 πSno,Cno(SC)÷πCno(Course)   πSno,Sname(Student) 

小结 
关系代数运算

- 并、差、交、笛卡尔积、投影、选择、连接、除

基本运算

- 并、差、笛卡尔积、投影、选择

交、连接、除

- 可以用5种基本运算来表达

引进它们并不增加语言的能力，但可以简化表达

 